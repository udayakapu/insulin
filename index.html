<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Medication Administration</title>
<link href="style.css" rel="stylesheet" type="text/css" />
<link href="modules_css.css" rel="stylesheet" type="text/css" />

<script src="jQueryAssets/jquery-1.8.3.min.js" type="text/javascript"></script>
<script>

	var terminologyObject = new Object();
	terminologyObject['847265'] = "Novolog 100 units/mL (standard formulary)";
	terminologyObject['450725013'] = "Interval ordering (Q4, Q6 etc.,)";
	terminologyObject['1221322014'] = "Meal time ordering";
	terminologyObject['43163-5'] = "qac";
	terminologyObject['1785451015'] = "qhs";
	terminologyObject['other'] = "other";
	terminologyObject['0200'] = "0200";
	terminologyObject['C0587181'] = "2 hours postprandial";
	
	
	
    function showMedAdminSection(){
		document.getElementById('med_admin').style.display="block";
		document.getElementById('med_id').style.display="none";
		
		var rd_length = document.getElementsByName("freq").length;
		var rd_value = "";
		var frequency = "";
		
		for(i=0; i<rd_length; i++) {
			if(document.getElementsByName("freq").item(i).checked){
				frequency = terminologyObject[document.getElementsByName("freq").item(i).value];				
				break;
			}
		}	
		
		if(document.getElementById("qac").checked){
			frequency = frequency+","+ terminologyObject[document.getElementById("qac").value];
		}
		
		if(document.getElementById("qhs").checked){
			frequency = frequency+","+ terminologyObject[document.getElementById("qhs").value];
		}
		
				
		if(document.getElementById("0200").checked){
			frequency = frequency+","+ terminologyObject[document.getElementById("0200").value];
		}
		
		if(document.getElementById("2hr").checked){
			frequency = frequency+","+ terminologyObject[document.getElementById("2hr").value];
		}
		
	
		if(document.getElementById("g_target_id").value != ""){
		    document.getElementById("glucose_target_id").innerHTML = document.getElementById("g_target_id").value;
		}
		
		if(document.getElementById("s_devisor_id").value != ""){
		document.getElementById("sensivity_devisor_id").innerHTML = document.getElementById("s_devisor_id").value;
		}
		
		if(document.getElementById("c_devisor_id").value != ""){
			document.getElementById("carb_cov_id").innerHTML = document.getElementById("c_devisor_id").value;
		}
		
		if(recent_glucose_value != ""){
			document.getElementById("glucose_id").innerHTML = recent_glucose_value.value;
		}
		
		var selected_med_id = document.getElementById("sel_med_id").value;
		
		document.getElementById("drug_id").innerHTML = terminologyObject[selected_med_id];
		document.getElementById("order_freq_id").innerHTML = frequency
		
		//buildDoseCalculationHtml();
	}
	
	function buildDoseCalculationHtml(){
		var iorder = new InsulinOrder('Novolog');
		calcInsulinUnits(iorder);
		var calcHtml = "((["+recent_glucose_value.value+"]-["+iorder.targetGlucose+"])/["+iorder.sensitivityDivisor+"])";
	calcHtml = calcHtml + "+(["+iorder.carbsConsumed+"] / ["+iorder.carbSensitivityDivisor+"])";
	
	  document.getElementById("formula_id").innerHTML = calcHtml;
	  
	}
	
	function showMedSection(){
		document.getElementById('med_admin').style.display="none";
		document.getElementById('med_id').style.display="block";
	}
	
	
	// 1. Place insulin order data into InsulinOrder object.
// 2. On administration, get InsulinOrder object and validate carbohydrates entered.
// 3. Calculate units

// create insulin order object
function InsulinOrder(name){
	this.insulinName = name;
	this.targetGlucose = document.getElementById("g_target_id").value;
	this.sensitivityDivisor = document.getElementById("s_devisor_id").value;
	this.carbSensitivityDivisor = document.getElementById("c_devisor_id").value;
	this.carbsConsumed = document.getElementById("carb_consume_id").value;
}

// create lab object
function LabResult(name){
	this.labName = name;
	this.date = new Date();
	this.value = 0;
}

// create instance of LabResult and populate
	var recent_glucose_value = new LabResult('Glucose');
		recent_glucose_value.date = new Date();
		recent_glucose_value.value = 140;

// validate InsulinOrder
function validateInsulinOrder(order){
	targetGlucoseConfirm = true;
	sensitivityDivisorConfirm = true;
	carbSensitivityDivisorConfirm = true;
	
	//console.log(order.insulinName.toLowerCase());
	if (!(order.insulinName.toLowerCase().indexOf("humalog") > -1 || order.insulinName.toLowerCase().indexOf("novolog") > -1)){
		return false;
	}

	//console.log(order.targetGlucose);
	if (isNaN(order.targetGlucose) || order.targetGlucose < 100 || order.targetGlucose > 140){
		targetGlucoseConfirm = confirm("Target insulin is outside normal range.  Continue?");
	}
	
	//console.log(order.sensitivityDivisor);
	if (isNaN(order.sensitivityDivisor) || order.sensitivityDivisor > 30 || order.sensitivityDivisor < 5){
		sensitivityDivisorConfirm = confirm("Sensitivity Divisor is outside normal range.  Continue?");
	}
	
	//console.log(order.carbSensitivityDivisor);
	if (isNaN(order.carbSensitivityDivisor) || order.carbSensitivityDivisor > 20 || order.carbSensitivityDivisor < 10){
		carbSensitivityDivisorConfirm = confirm("Carbohydrate Sensitivity Divisor is outside normal range.  Continue?");
	}
	
	return targetGlucoseConfirm && sensitivityDivisorConfirm && carbSensitivityDivisorConfirm;
}

function calcInsulinUnits(iorder){
	
	validateInsulinOrder(iorder);
	
	// At this point it is assumed that all values have been check for 
	// realistic ranges and units. Simply do the calculation and return the value.
	glucoseCorrection = Math.floor((recent_glucose_value.value - iorder.targetGlucose) / iorder.sensitivityDivisor);
	carbCorrection = calcCarbCoverage(iorder.carbsConsumed, iorder.carbSensitivityDivisor);
	dose = Math.floor(glucoseCorrection) + Math.floor(carbCorrection);
     alert(dose);
	return Math.floor(dose); 
}

function calcCarbCoverage(iorder){
	if (!isNaN(iorder.carbsConsumed)){
		return Math.floor(iorder.carbsConsumed/iorder.carbSensitivityDivisor);
	} else {
		alert("Invalid carbohydrate amount.");
	}
}
	
	
</script>

</head>
<body onload="showMedSection();">
<div id="wrapper">
<div id="">
                <h2 align="center" class="m_mainHeader_1"><strong><em>	Nursing Patient Dashboard / Reporting</em></strong></h2>

		  
	</div>
	
	<div class="subSubTabs" id="menu">
		<ul>
			<li class="current_page_item"><a href="#">My Patient </a></li>
			<li><a href="#">CPOE</a></li>
			<li><a href="#">Documentation</a></li>
			<li><a href="#">Task Manager</a></li>
			<li><a href="#">Protocols</a></li>
			<li><a href="#">E-resources</a></li>
            <li><a href="#">Setup</a></li>
			<li><a href="#">Help</a></li>
		</ul>
	</div>
	<!-- end #menu -->
  <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center" class="m_mainTable">
      <tr>
        <td class="m_topMiddle" height="2"></td>
      </tr>
      <tr>
        <td class="m_mainHeader_1" colspan="2"><input type="button" name="button2" id="button2" value="Change Patient" /> 
             &nbsp;&nbsp;&nbsp;&nbsp;Patient: TEST, DAVID&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;MRN: 0123456789&nbsp;&nbsp;&nbsp;&nbsp;DOB: 4/1/1980</td>
      </tr>
      </table>  
  <table width="100%" border="0" cellspacing="0" cellpadding="0">
    <tr><td>

     <div id="maintabs">
      <ul class="m_subHeader">
              <li><a href='' title="Nursing">Nursing
              </a>
              </li>
               <li>
                <a href='' title="Radiology">
                  Radiology
                </a>
              </li>
        <li>
                <a href='' title="Rx">
                  Rx
                </a>
        </li>
            <li>
                <a href='' title="Laboratory">
                  Laboratory
                </a>
              </li>
      </ul>
  </div>
     </td></tr></table>
 <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center" class="m_mainTable">
      <tr>
        <td class="m_topMiddle" height="2"></td>
      </tr>
     
  </table>
     
     <table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="">
    <tr><td>

     <div id="maintabs">
      <ul class="m_subHeader">
              <li>
                <a href='#' title="Medications" onclick='showMedSection();'>
                  Medications
                </a>
              </li>
              <li>
                <a href='#' title="Med Admin" onclick='showMedAdminSection();'>
                  Medication Administration
                </a>
              </li>
              
      </ul>
  </div>
     </td></tr></table>
<!-- start of medication  --> 
 <div id="med_id">   
 <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center" class="m_mainTable">
      <tr>
        <td class="m_topMiddle" height="2"></td>
      </tr>
      <tr>
        <td class="m_mainHeader_1" colspan="2">Medications</td>
      </tr>
      </table>
     
  <div id="page">
	<div id="page-bgtop">
	<div id="page-bgbtm">
		<div id="content">
			<div class="post">
			<div class="post-bgtop">
			<div class="post-bgbtm">
				<h2 class="title"><a href="#">Novlog Order Details</a></h2>
                <div id="divPlaceHolder" class="orphan" style="width:180px;">
			     <select style="width:280px;" name="sel_med_id" id="sel_med_id" onChange="this.focus();">
                   <option value="847265">Novolog 100 units/mL (standard formulary)</option>
				</select>
                </div>
                <div class="entry">
				  <p>Based on the following equation:</p>
				  <p><img src="images/formula/formula.jpg" width="511" height="74" /></p>
				</div>
			</div>
			</div>
			</div>
			<div class="post">
			<div class="post-bgtop">
			<div class="post-bgbtm">
				<h2 class="title">Frequency</h2>
				<div class="entry">
				  <table width="602" border="0" cellpadding="0" cellspacing="8">
					<tr> <td valign="top"> 
                            <table border="0" cellpadding="2" cellspacing="1">
                              <tr><td>
                                <p>
                              <label>
                                <input type="radio" name="freq" value="450725013" id="freq_0" />
                              Interval ordering (Q4, Q6 etc.,)</label>
                              <br />
                              <label>
                                <input type="radio" name="freq" value="1221322014" id="freq_1" />
                                Meal time ordering</label>
                              <br />
                              <label>
                                <input type="radio" name="freq" value="other" id="freq_2" />
                                Other</label>
                              <br />
                            </p>
                              </td></tr>
                            </table>
                        </td>
                 
                    <td valign="top"> 
                        <table border="0" cellpadding="2" cellspacing="1">
                          <tr><td><table width="200">
                            <tr>
                              <td><label>
                                <input type="checkbox" name="qac" value="43163-5" id="qac" />  <!-- LOINC -->
                                QAC</label></td>
                            </tr>
                            <tr>
                              <td><label>
                                <input type="checkbox" name="qhs" value="1785451015" id="qhs" />
                                QHS</label></td>
                            </tr>
                            <tr>
                              <td><label>
                                <input type="checkbox" name="0200" value="0200" id="0200" />
                                0200</label></td>
                            </tr>
                            <tr>
                              <td><label>
                                <input type="checkbox" name="2hr" value="C0587181" id="2hr" />
                                2 hours postprandial</label></td>
                            </tr>
                          </table></td></tr>
                        </table>
                    </td> 
                    
                    </tr>
                </table>   
				</div>
                 
			</div>
			</div>
			</div>
			<div class="post">
			<div class="post-bgtop">
			<div class="post-bgbtm">
				<hr />
			    <p>
			      <label for="textfield" style="font-size: 12px"> Glucose Target:</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				    <input name="g_target_id" type="text" id="g_target_id" size="10"  />
				    mg/dl &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Ref Range: 80 - 190</p> 
			    <p>
			    <label for="textfield2" style="font-size: 12px">Sensitivity Divisor:</label>&nbsp;&nbsp;&nbsp;
		        <input name="s_devisor_id" type="text" id="s_devisor_id" size="10" />
		        &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Ref Range: 10 - 60
			     </p>
			    <p>
			      <input type="checkbox" name="checkbox" id="checkbox" />
                  <label for="checkbox"><span style="font-size: 12px">Use Carbohydrate:Insulin Sensitivity of 1 unit</span> = </label>
			    
		          <input name="c_devisor_id" type="text" id="c_devisor_id" size="10" />
carbohydrates &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ref Range: 5 - 40</p>
			    <p>
			      <input type="submit" name="submit" id="submit" value="Save Changes" />
			    </p>
			    
			</div>
			</div>
			</div>
		
		</div>
		<!-- end #content -->
		<div id="sidebar">
			<ul>
				<li>
				  <h2>Menu</h2>
					<ul>
					  <li><a href="#">Metoprolol</a></li>
					  <li><a href="#">Novolog</a></li>
					  <li><a href="#">Alprazolam</a></li>
					  <li><a href="#">Ondansetron</a></li>
                      <li><a href="#">Pantoprazole</a></li>
					  <li><a href="#">Allopurinol</a></li>
					  <li><a href="#">Acetaminophen</a></li>
					  <li><a href="#">Enoxaparin sodium</a></li>
                      <li><a href="#">Furosemide</a></li>
					  <li><a href="#">Potassium Chloride</a></li>					  
				  </ul>
				</li>
				<li>
					<h2>New Order:</h2>
					<p>
					  <input type="search" name="search" id="search" />
					</p>
				</li>				
			</ul>
		</div>
		<!-- end #sidebar -->
		<div style="clear: both;">&nbsp;</div>
	</div>
	</div>
  </div>
	<!-- end #page -->
</div>
<!-- end of medication section -->    

<!-- start of medication administration -->
<div id="med_admin"> 
  <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center" class="m_mainTable">
      <tr>
        <td class="m_topMiddle" height="2"></td>
      </tr>
      <tr>
        <td class="m_mainHeader_1" colspan="2">Medication Administration</td>
      </tr>
      </table>
  <div id="page">
	<div id="page-bgtop">
        <div id="content">
		  <div class="post">
				<div class="post-bgtop">
                    <div class="post-bgbtm">
                            <h2 class="title"><a href="#">Novlog Order Details</a></h2>
                                <div id="divPlaceHolder" class="orphan" style="width:180px;"></div>
                                      <div class="entry">
                                        <p>Medication: <span id="drug_id"></span></p>
                                        <p>Glucose: <span id="glucose_id"></span></p>
                                        <p>Glucose Target: <span id="glucose_target_id"></span></p>
                                        <p>Sensitivity Devisor: <span id="sensivity_devisor_id"></span></p>
                                        <p>Order Frquency: <span id="order_freq_id"></span></p>
                                        <p>Carbohydrate Coverage: <span id="carb_cov_id"></span></p>
                                        <p>Carbohydrates consumed by the patient for this dose:
                                       <input name="carb_consume_id" type="text" id="carb_consume_id" size="10" />
                                        </p>                  
                                      </div>
                                 </div>
                    </div>	
		  		 </div>
		  <div class="post">
			<div class="post-bgtop">
			<div class="post-bgbtm">
			  <h2 class="title">Order:</h2>
			  <div class="entry"><img src="images/formula/formula1.jpg" width="512" height="51" /></div>
                 
			</div>
			</div>
		  </div>
		  <div class="post">
			<div class="post-bgtop">
			<div class="post-bgbtm">
			<input type="button" name="button3" id="button3" value="Calculate Dose" onClick="buildDoseCalculationHtml();calcInsulinUnits();" />
			  <hr />
               <span id="formula_id"></span>
               <hr/>
					
		      <p>
		        <input type="submit" name="submit" id="submit" value="Save Dose Details" />
		      </p>
			    
			</div>
			</div>
		  </div>
		
	  </div>
	  <!-- end #content -->
	  <div id="sidebar">
		  <ul>
			  <li>
			    <h2>Scanned Meds</h2>
				  <ul>
				    <li>[X] Alprazolam</li>
				    <li><a href="#">[X] Ondansetron</a></li>
				    <li>[X] Novolog</li>					  
			    </ul>
			  </li>
			  <li>
				  <h2>Available Meds:</h2>
				  <p>
				    <select name="select" size="6" id="select">
                      <option>Metoprolol</option>
                      <option>Pantoprazole</option>
                      <option>Allopurinol</option>
                      <option>Acetaminophen</option>
                      <option>Enoxaparin sodium</option>
                      <option>Furosemide</option>
                      <option>Furosemide</option>
                    </select>
				  </p>
				  <p>
				    <input type="button" name="button" id="button" value="Scan More" />
				  </p>
			  </li>
              <li></li>
	    </ul>
	  </div>
	  <!-- end #sidebar -->
	  <div style="clear: both;">&nbsp;</div>
	</div>
  </div>
	<!-- end #page -->
 </div>
</div>
<!-- end of medication administration -->
<!--div id="footer">
		<p>Copyright (c) 2013 Nursing Patient Dashboard. All rights reserved.</p>
	</div -->
	<!-- end #footer -->

</body>
</html>
